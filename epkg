#!/usr/bin/env bash

#####
# since portage tree is out of squashfs, it wont be available in the iso image as well
# epkg will fail miserably because portage profiles are no longer available and not set
# source kogaion user mode by default to get portage profiles so epkg will work flawless
source /usr/share/epkg/kogaionuser 
#####
action=$1
shift

case "$action" in
	install)
		emerge -av "$@"
		;;
	remove)
		emerge --depclean -av "$@"
		;;
	forceremove)
		emerge --unmerge -av "$@"
		;;
	autoremove)
		emerge --depclean -a "$@"
		;;
	search)
		emerge -s "$@"
		;;
	update)
		/usr/share/epkg/kogaionsync
		;;
	upgrade)
		emerge -uDvaN --with-bdeps=y @system @world "$@"
		;;
	clean)
		eclean -d packages
		;;
	cleanall)
		rm -rf /usr/portage/packages
		;;
	list)
		qlist "$@"
		;;
	listall)
		qlist -ICv "$@"
		;;
	check)
		qcheck "$@"
		;;
	checkall)
		qcheck
		;;
	provides)
		qfile -Cv "$@"
		;;
	sysinfo)
		emerge --info "$@"
		;;
	*)
		cat <<-"EOH"
			Usage: epkg command [package(s)]

			epkg is a simple wrapper around portage, gentoolkit, and portage-utils that provides an
			apt-get/yum-alike interface to these commands, to assist people transitioning from
			Debian/RedHat-based systems to Gentoo.

			Commands [equivalent Gentoo command]:
				install - Install new packages [emerge -av package(s)]
				remove - Remove packages safely [emerge --depclean -av packages(s)]
				forceremove - *Unsafely* remove packages [emerge --unmerge -av package(s)]
				autoremove - Remove packages that are no longer needed [emerge --depclean -a]
				search - Search for packages [emerge -s package]
				update - Retrieve updated kogaion portage configs [kogaionsync]
				upgrade - Update installed packages [emerge -NDuav --with-bdeps=y @system world]
				clean - Remove old binary packages from packages dir [eclean -d packages]
				cleanall - Remove all binary packages from packages dir [rm -rf /usr/portage/packages/*]
				list - List the files belonging to a package [qlist package]
				listall - List ALL installed packages [qlist -ICv package]
				check - Check a packages installed files match the checksum and timestamp they had when first installed [qcheck package]
				checkall - Same as above, but against all installed packages [qcheck]
				provides - List the installed package(s) which own the indicated file [qfile file]
				sysinfo - Display information about installed core packages and portage configuration [emerge --info]
		EOH
		;;
esac
